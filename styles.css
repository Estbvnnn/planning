/* iOS: stop zoom on tap/focus */
html { -webkit-text-size-adjust: 100%; }

button,
.btn, .mini-btn, .chip, .fab, .hamburger, .icon-btn,
input, select, textarea, label {
  font-size: 16px;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

:root{
  --bg:#121214; --panel:#1b1c21; --muted:#9aa0ac; --text:#eef0f7;
  --grad-a:#6f6bff; --grad-b:#4a7ee8; --danger:#ef4444;
  --card:#1f2129; --ring:rgba(94,110,255,.32); --shadow:0 10px 28px rgba(0,0,0,.38);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--text);
  font:15px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,"Helvetica Neue",Arial;
}
#edgeOpener{position:fixed;left:0;top:0;width:24px;height:100dvh;z-index:140;background:transparent}

/* Topbar */
.topbar{
  position:sticky;top:0;z-index:150;
  display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:.5rem;
  padding:env(safe-area-inset-top) 10px 10px;
  background:rgba(18,18,20,.75);backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.06)
}
.hamburger{width:42px;height:36px;background:none;border:0;padding:0;display:flex;flex-direction:column;justify-content:center;gap:5px;cursor:pointer}
.hamburger span{display:block;height:2px;background:#fff;width:22px;border-radius:2px}
.top-title{font-weight:700;opacity:.95;letter-spacing:.4px}
.top-actions{display:flex;align-items:center;gap:.5rem}
.install-btn{border:1px solid rgba(255,255,255,.12);background:none;color:var(--text);padding:.45rem .7rem;border-radius:10px;font-weight:700}

/* Drawer */
.drawer{
  position:fixed;inset:0;width:86%;max-width:360px;
  transform:translateX(-120%);transition:transform .25s ease-out;
  background:var(--panel);box-shadow:var(--shadow);
  padding-top:env(safe-area-inset-top);display:flex;flex-direction:column;z-index:200
}
.drawer.open{transform:translateX(0)}
.drawer-header{display:flex;align-items:center;justify-content:space-between;padding:14px 14px 8px;border-bottom:1px solid rgba(255,255,255,.06)}
.brand-logo{width:26px;height:26px;border-radius:8px;display:block}
.icon-btn{border:0;background:none;color:var(--text);font-size:18px}
.drawer-section{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
.section-title{font-size:12px;letter-spacing:.8px;color:var(--muted);text-transform:uppercase;margin-bottom:8px}
.caption{font-size:12px;color:var(--muted);margin:0 0 8px}
.year-list{list-style:none;padding:0;margin:0 0 10px;display:flex;flex-direction:column;gap:8px;max-height:30vh;overflow:auto}
.drawer-footer{margin-top:auto;padding:12px 14px 14px;color:var(--muted)}
.drawer-footnote{margin-top:10px;font-size:12px;opacity:.7}

/* Buttons */
.btn{
  border:0;border-radius:14px;font-weight:800;letter-spacing:.2px;
  padding:.68rem .95rem;cursor:pointer;transition:transform .06s ease,box-shadow .2s ease;
  display:inline-flex;align-items:center;justify-content:center;gap:.5rem;min-height:42px;width:100%
}
.btn:active{transform:translateY(1px)}
.btn--solid{color:#fff;background:linear-gradient(135deg,var(--grad-a),var(--grad-b));box-shadow:0 14px 28px rgba(74,126,232,.25)}
.btn--ghost{color:#fff;background:linear-gradient(135deg,rgba(111,107,255,.18),rgba(74,126,232,.18));border:1px solid rgba(255,255,255,.08)}
.btn--outline{color:#fff;background:transparent;border:1px solid rgba(255,255,255,.22)}
.stack{display:grid;gap:8px}
.file-btn{position:relative;overflow:hidden}
.file-btn input{position:absolute;left:-9999px;width:0.1px;height:0.1px;opacity:0;overflow:hidden;z-index:-1}

.mini-btn{background:linear-gradient(135deg,rgba(111,107,255,.2),rgba(74,126,232,.2));color:#fff;border:1px solid rgba(255,255,255,.1);padding:.35rem .6rem;border-radius:10px;font-size:12px;width:auto}
.mini-btn.danger{background:rgba(239,68,68,.12);color:#fecaca}
.chip{border:0;border-radius:999px;padding:.45rem .7rem;font-weight:700;background:linear-gradient(135deg,rgba(111,107,255,.18),rgba(74,126,232,.18));color:#fff;border:1px solid rgba(255,255,255,.08);width:auto}
.chip.ghost{background:transparent;border:1px solid rgba(255,255,255,.15)}
.menu{position:absolute;right:10px;top:56px;z-index:170;background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:14px;box-shadow:var(--shadow);padding:6px;display:flex;flex-direction:column;gap:4px}
.menu[hidden]{display:none!important}
.menu button{all:unset;padding:.55rem .8rem;border-radius:10px;cursor:pointer}
.menu button:hover{background:rgba(255,255,255,.06)}

/* Home */
.home{min-height:calc(100dvh - 64px);display:grid;place-items:center;text-align:center;gap:12px}
.big-plus{width:84px;height:84px;border-radius:24px;display:grid;place-items:center;font-size:48px;background:linear-gradient(135deg,var(--grad-a),var(--grad-b));color:#fff;box-shadow:0 18px 40px rgba(74,126,232,.32)}
.muted{color:var(--muted)}
.muted-narrow{max-width:24ch;margin:0 12px}

/* Calendar */
.calendar{max-width:1100px;margin:0 auto;padding:10px}
.cal-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:4px 2px 10px}
.cal-label{font-weight:800;letter-spacing:.3px}
.cal-actions{display:flex;align-items:center;gap:8px}
.fab{width:48px;height:48px;border-radius:16px;display:grid;place-items:center;font-size:22px;background:linear-gradient(135deg,var(--grad-a),var(--grad-b));color:#fff;box-shadow:0 14px 30px rgba(74,126,232,.3)}
.cal-content{min-height:calc(100dvh - 140px)}

/* Views */
.day-list{display:grid;gap:10px}
.week-grid{display:grid;gap:10px;grid-template-columns:1fr} /* vertical */
.week-col{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:10px}
.week-col h4{margin:2px 2px 8px;font-size:12px;color:var(--muted);letter-spacing:.3px;text-transform:uppercase}
.month-grid{display:grid;gap:6px;grid-template-columns:repeat(7,1fr)}
.month-cell{min-height:90px;background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:6px;position:relative}
.month-cell .d{font-size:12px;color:var(--muted)}
.dot{width:6px;height:6px;border-radius:999px;background:linear-gradient(135deg,var(--grad-a),var(--grad-b));display:inline-block;margin-right:4px}

/* Cards */
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:12px;box-shadow:var(--shadow)}
.card-row{display:flex;align-items:center;justify-content:space-between;gap:10px}
.card-title{font-weight:800}
.card-date{color:var(--muted);font-variant-numeric:tabular-nums}
.card-notes{margin-top:6px;color:#bfc2ce;white-space:pre-wrap}
.card-actions{display:flex;gap:8px;margin-top:10px}

/* ---------- Dialogs ---------- */
.modal{
  border:0; padding:0; background:transparent; position:fixed; inset:0;
  display:none; z-index:1000;
}
.modal[open]{
  display:grid; place-items:center;
  padding-top:env(safe-area-inset-top);
  padding-bottom:calc(18px + env(safe-area-inset-bottom));
  padding-left:max(18px, env(safe-area-inset-left));
  padding-right:max(18px, env(safe-area-inset-right));
}
.modal::backdrop{background:rgba(0,0,0,.55)}
.modal-card{
  background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:18px;
  width:min(520px, 100%); max-height:calc(100dvh - 24px - env(safe-area-inset-bottom));
  padding:20px; margin:auto; color:var(--text); box-shadow:var(--shadow);
  display:flex; flex-direction:column; overflow:auto; -webkit-overflow-scrolling:touch;
}
.modal-card h3{margin:4px 0 12px;font-size:26px}
.field{display:grid;gap:6px;margin:10px 0}
.row{display:flex;gap:10px;flex-wrap:wrap}

/* Inputs */
.field input,
.field textarea,
.modal-card select{
  display:block; width:100%; min-width:0; max-width:100%;
  background:#14161b; color:var(--text);
  border:1px solid rgba(255,255,255,.14); border-radius:12px;
  padding:.75rem 1rem; outline:none; box-sizing:border-box;
}
.field input:focus,.field textarea:focus,.modal-card select:focus{
  box-shadow:0 0 0 6px var(--ring); border-color:transparent;
}

@media (max-width: 360px){
  .modal-card{ width:calc(100vw - 56px); }
}

/* Themes */
html[data-theme="ardoise"]{
  --bg:#101113; --panel:#17181c; --muted:#a6abb6; --text:#f2f4fa;
  --grad-a:#6663e6; --grad-b:#3d6fd1; --card:#191b20; --ring:rgba(102,99,230,.28);
}
html[data-theme="porcelaine"]{
  --bg:#f7f8fb; --panel:#ffffff; --muted:#6b7280; --text:#0f172a;
  --grad-a:#6f6bff; --grad-b:#4a7ee8; --card:#ffffff; --ring:rgba(74,126,232,.25); --shadow:0 10px 28px rgba(2,6,23,.10)
}
html[data-theme="porcelaine"] .topbar{background:rgba(255,255,255,.9);border-bottom:1px solid #e5e7eb}
html[data-theme="porcelaine"] .drawer-section{border-bottom:1px solid #eef0f4}
html[data-theme="porcelaine"] .card{border-color:#e5e7eb}
html[data-theme="porcelaine"] .field input,
html[data-theme="porcelaine"] .field textarea,
html[data-theme="porcelaine"] .modal-card select{background:#fff;border-color:#e5e7eb;color:#0f172a}

/* iOS: retire déco native et réserve de l’espace à droite */
@supports (-webkit-touch-callout: none) {
  select, input[type="time"]{
    -webkit-appearance: none; appearance: none; background-image: none;
    padding-right: 2.4rem;
  }
}

/* === iPhone date input hotfix (v6.3.10) === */
#itemDate{
  width:100% !important; max-width:100% !important; min-width:0 !important;
  -webkit-appearance:none; appearance:none;
  padding-right:2.6rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  box-sizing:border-box;
}
@supports (-webkit-touch-callout: none) {
  #itemDate{ -webkit-padding-end:2.6rem; }
  #itemDate::-webkit-date-and-time-value{ text-align:left; }
  #itemDate::-webkit-calendar-picker-indicator{ margin-right:.25rem; }
}

/* --- Compactage des boutons Tools + Settings en bas --- */
.btn--compact{
  min-height:36px;
  padding:.48rem .72rem;
  border-radius:10px;
  font-weight:700;
  font-size:14px;
}
.drawer-section.tools .stack{ gap:6px; }
.drawer-section.tools .btn{ font-size:14px; min-height:36px; padding:.48rem .72rem; border-radius:10px; }
.drawer-footer{
  margin-top:auto;
  padding:12px 14px calc(14px + env(safe-area-inset-bottom));
}
.drawer-footer .btn{ width:100%; margin-bottom:8px; }
